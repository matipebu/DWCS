<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Conexiones y su administraci&oacute;n</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

 </head>
 <body class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="pdo.constants.html">« Constantes predefinidas</a></li>
      <li style="float: right;"><a href="pdo.transactions.html">Transacciones y autoconsigna (&quot;auto-commit&quot;) »</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="book.pdo.html">PDO</a></li>
    <li>Conexiones y su administraci&oacute;n</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="pdo.connections" class="chapter">
 <h1 class="title">Conexiones y su administración</h1>

 <p class="para">
  Las conexiones se establecen creando instancias de la clase base PDO.
  No importa el controlador que se utilice; siempre se usará el nombre de
  la clase PDO. El constructor acepta parámetros para especificar el
  origen de la base de datos (conocido como DSN) y, opcionalmente, el nombre de usuario
  y la contraseña (si la hubiera).
 </p>
 <p class="para">
  <div class="example" id="example-1005">
   <p><strong>Ejemplo #1 Conectarse a MySQL</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />$mbd </span><span style="color: #007700">= new </span><span style="color: #0000BB">PDO</span><span style="color: #007700">(</span><span style="color: #DD0000">'mysql:host=localhost;dbname=prueba'</span><span style="color: #007700">, </span><span style="color: #0000BB">$usuario</span><span style="color: #007700">, </span><span style="color: #0000BB">$contraseña</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div> 
   </div>

  </div>
 </p>
 <p class="para">
  Si hubieran errores de conexión, se lanzará un objeto <code class="literal">PDOException</code>.
  Se puede capturar la excepción si fuera necesario manejar
  la condición del error, o se podría optar por dejarla en manos de un
  manejador de excepciones global de aplicación configurado mediante
  <span class="function"><a href="function.set-exception-handler.html" class="function">set_exception_handler()</a></span>.
 </p>
 <p class="para">
  <div class="example" id="example-1006"><p><strong>Ejemplo #2 Manejo de errores de conexión</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">try {<br />    </span><span style="color: #0000BB">$mbd </span><span style="color: #007700">= new </span><span style="color: #0000BB">PDO</span><span style="color: #007700">(</span><span style="color: #DD0000">'mysql:host=localhost;dbname=prueba'</span><span style="color: #007700">, </span><span style="color: #0000BB">$usuario</span><span style="color: #007700">, </span><span style="color: #0000BB">$contraseña</span><span style="color: #007700">);<br />    foreach(</span><span style="color: #0000BB">$mbd</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">'SELECT * from FOO'</span><span style="color: #007700">) as </span><span style="color: #0000BB">$fila</span><span style="color: #007700">) {<br />        </span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">$fila</span><span style="color: #007700">);<br />    }<br />    </span><span style="color: #0000BB">$mbd </span><span style="color: #007700">= </span><span style="color: #0000BB">null</span><span style="color: #007700">;<br />} catch (</span><span style="color: #0000BB">PDOException $e</span><span style="color: #007700">) {<br />    print </span><span style="color: #DD0000">"¡Error!: " </span><span style="color: #007700">. </span><span style="color: #0000BB">$e</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getMessage</span><span style="color: #007700">() . </span><span style="color: #DD0000">"&lt;br/&gt;"</span><span style="color: #007700">;<br />    die();<br />}<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
   </div>

  </div>
 </p>
 <div class="warning"><strong class="warning">Advertencia</strong>
  <p class="para">
   Si la aplicación no captura la excepción lanzada por el constructor
   de PDO, la acción predeterminada que toma el motor zend es la de finalizar
   el script y mostrar información de seguimiento. Esta información probablemente revelará
   todos los detalles de la conexión a la base de datos, incluyendo el nombre de usuario y
   la contraseña. Es su responsabilidad capturar esta excepción, ya sea
   explícitamente (con una sentencia <code class="literal">catch</code>) o implícitamente por medio de
   <span class="function"><a href="function.set-exception-handler.html" class="function">set_exception_handler()</a></span>.
  </p>
 </div>
 <p class="para">
  Una vez realizada con éxito una conexión a la base de datos, será devuelta una instancia
  de la clase PDO al script. La conexión permanecerá activa durante el tiempo
  de vida del objeto PDO. Para cerrar la conexión, es necesario
  destruir el objeto asegurándose de que todas las referencias a él existentes sean
  eliminadas; esto se puede hacer asignando <strong><code><a href="reserved.constants.html#constant.null">null</a></code></strong> a la variable que contiene el
  objeto. Si no se realiza explícitamente, PHP cerrará automáticamente
  la conexión cuando el script finalice.
 </p>
 <blockquote class="note"><p><strong class="note">Nota</strong>: 
  <span class="simpara">
   Si aún existen otras referencias a esta instancia de PDO (tales como desde una
   instancia de PDOStatement, o desde otras variables que hacen referencia a la misma
   instancia de PDO), estas también han de eliminarse (por ejemplo, asignando NULL a
   la variable que hace referencia al PDOStatement).
  </span>
 </p></blockquote>
 <p class="para">
  <div class="example" id="example-1007">
   <p><strong>Ejemplo #3 Cerrar una conexión</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />$mbd </span><span style="color: #007700">= new </span><span style="color: #0000BB">PDO</span><span style="color: #007700">(</span><span style="color: #DD0000">'mysql:host=localhost;dbname=prueba'</span><span style="color: #007700">, </span><span style="color: #0000BB">$usuario</span><span style="color: #007700">, </span><span style="color: #0000BB">$contraseña</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">// Utilizar la conexión aquí<br /></span><span style="color: #0000BB">$sth </span><span style="color: #007700">= </span><span style="color: #0000BB">$mbd</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">'SELECT * FROM foo'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// Ya se ha terminado; se cierra<br /></span><span style="color: #0000BB">$sth </span><span style="color: #007700">= </span><span style="color: #0000BB">null</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$mbd </span><span style="color: #007700">= </span><span style="color: #0000BB">null</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
   </div>

  </div>
 </p>
 <p class="para">
  Muchas aplicaciones web se beneficiarán del uso de conexiones persistentes a
  servidores de bases de datos. Las conexiones persistentes no son cerradas al final del
  script, sino que son almacenadas en caché y reutilizadas cuando otro script solicite una
  conexión que use las mismas credenciales. La caché de conexiones persistentes
  permite evitar la carga adicional de establecer una nueva conexión cada vez
  que un script necesite comunicarse con la base de datos, dando como resultado
  una aplicación web más rápida.
 </p>
 <p class="para">
  <div class="example" id="example-1008">
   <p><strong>Ejemplo #4 Conexiones persistentes</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />$mbd </span><span style="color: #007700">= new </span><span style="color: #0000BB">PDO</span><span style="color: #007700">(</span><span style="color: #DD0000">'mysql:host=localhost;dbname=prueba'</span><span style="color: #007700">, </span><span style="color: #0000BB">$usuario</span><span style="color: #007700">, </span><span style="color: #0000BB">$contraseña</span><span style="color: #007700">, array(<br />    </span><span style="color: #0000BB">PDO</span><span style="color: #007700">::</span><span style="color: #0000BB">ATTR_PERSISTENT </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true<br /></span><span style="color: #007700">));<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
   </div>

  </div>
 </p>
 <blockquote class="note"><p><strong class="note">Nota</strong>: 
  <p class="para">
   Para utilizar conexiones persistentes, se deberá establecer
   <strong><code><a href="pdo.constants.html#pdo.constants.attr-persistent">PDO::ATTR_PERSISTENT</a></code></strong> en las opciones del array del controlador
   pasado al constructor de PDO. Si este atributo se establece con
   <span class="function"><a href="pdo.setattribute.html" class="function">PDO::setAttribute()</a></span> después de la instanciación del
   objeto, el controlador no utilizará conexiones persistentes.
  </p>
 </p></blockquote>
 <blockquote class="note"><p><strong class="note">Nota</strong>: 
  <p class="para">
   Si se usa el controlador PDO y las bibliotecas ODBC admiten el aprovisionamiento
   de conexiones ODBC (unixODBC y Windows lo hacen; podrían haber
   más), se recomienda no utilizar las conexiones persistentes de PDO,
   y, en su lugar, dejar el almacenamiento en caché de conexiones a la capa del aprovisionamiento
   de conexiones de ODBC. La provisión de conexiones de ODBC se comparte con otros
   módulos en el proceso; si se le indica a PDO que almacene en caché la conexión, entonces
   dicha conexión nunca será devuelta a la provisión de conexiones de ODBC,
   dando como resultado la creación de conexiones adicionales para servir a los
   demás módulos.
  </p>
 </p></blockquote>
</div>
</div></div></body></html>