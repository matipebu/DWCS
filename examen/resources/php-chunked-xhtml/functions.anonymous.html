<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Funciones an&oacute;nimas</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

 </head>
 <body class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="functions.internal.html">« Funciones internas (incluidas)</a></li>
      <li style="float: right;"><a href="functions.arrow.html">Funciones de flecha »</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="language.functions.html">Funciones</a></li>
    <li>Funciones an&oacute;nimas</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="functions.anonymous" class="sect1">
  <h2 class="title">Funciones anónimas</h2>

  <p class="simpara">
   Las funciones anónimas, también conocidas como <code class="literal">cierres</code> (closures), permiten
   la creación de funciones que no tienen un nombre especificado. Son más útiles como
   valor de los parámetros de <code class="literal">llamadas de retorno</code>,
   pero tienen muchos otros usos.
  </p>
  <p class="simpara">
   Las funciones anónimas están implementadas utilizando la clase <a href="class.closure.html" class="link">
   <span class="classname"><a href="class.closure.html" class="classname">Closure</a></span></a>.
  </p>

  <div class="example" id="example-194">
   <p><strong>Ejemplo #1 Ejemplo de función anónima</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">echo </span><span style="color: #0000BB">preg_replace_callback</span><span style="color: #007700">(</span><span style="color: #DD0000">'~-([a-z])~'</span><span style="color: #007700">, function (</span><span style="color: #0000BB">$coincidencia</span><span style="color: #007700">) {<br />    return </span><span style="color: #0000BB">strtoupper</span><span style="color: #007700">(</span><span style="color: #0000BB">$coincidencia</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">]);<br />}, </span><span style="color: #DD0000">'hola-mundo'</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">// imprime holaMundo<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
   </div>

  </div>

  <p class="simpara">
   Los cierres también se pueden usar como valores de variables; PHP automáticamente
   convierte tales expresiones en instancias de la
   clase interna <span class="classname"><a href="class.closure.html" class="classname">Closure</a></span>. La asignación de un cierre a una
   variable emplea la misma sintaxis que cualquier otra asignación, incluido el
   punto y coma final:
  </p>

  <div class="example" id="example-195">
   <p><strong>Ejemplo #2 Ejemplo de asignación de variable de una función anónima</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />$saludo </span><span style="color: #007700">= function(</span><span style="color: #0000BB">$nombre</span><span style="color: #007700">)<br />{<br />    </span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"Hola %s\r\n"</span><span style="color: #007700">, </span><span style="color: #0000BB">$nombre</span><span style="color: #007700">);<br />};<br /><br /></span><span style="color: #0000BB">$saludo</span><span style="color: #007700">(</span><span style="color: #DD0000">'Mundo'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$saludo</span><span style="color: #007700">(</span><span style="color: #DD0000">'PHP'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
   </div>

  </div>

  <p class="simpara">
   Los cierres también pueden heredar variables del ámbito padre. Cualquier
   variable debe ser pasada al constructor de lenguaje <code class="literal">use</code>.
   Desde PHP 7.1, estas variables no deben incluir <a href="language.variables.predefined.html" class="link">superglobals</a>,
   <var class="varname">$this</var>, o variables con el mismo nombre que un parámetro.
  </p>

  <div class="example" id="example-196">
   <p><strong>Ejemplo #3 Heredar variables de un ámbito padre</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />$mensaje </span><span style="color: #007700">= </span><span style="color: #DD0000">'hola'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// Sin "use"<br /></span><span style="color: #0000BB">$ejemplo </span><span style="color: #007700">= function () {<br />    </span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$mensaje</span><span style="color: #007700">);<br />};<br /></span><span style="color: #0000BB">$ejemplo</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">// Heredar $mensaje<br /></span><span style="color: #0000BB">$ejemplo </span><span style="color: #007700">= function () use (</span><span style="color: #0000BB">$mensaje</span><span style="color: #007700">) {<br />    </span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$mensaje</span><span style="color: #007700">);<br />};<br /></span><span style="color: #0000BB">$ejemplo</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">// El valor de la variable heredada está cuando la función<br />// está definida, no cuando se le invoca<br /></span><span style="color: #0000BB">$mensaje </span><span style="color: #007700">= </span><span style="color: #DD0000">'mundo'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$ejemplo</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">// Reiniciar el mensaje<br /></span><span style="color: #0000BB">$mensaje </span><span style="color: #007700">= </span><span style="color: #DD0000">'hola'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// Heredar por referencia<br /></span><span style="color: #0000BB">$ejemplo </span><span style="color: #007700">= function () use (&amp;</span><span style="color: #0000BB">$mensaje</span><span style="color: #007700">) {<br />    </span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$mensaje</span><span style="color: #007700">);<br />};<br /></span><span style="color: #0000BB">$ejemplo</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">// El valor cambiado en el ámbito padre<br />// se refleja dentro de la llamada a la función<br /></span><span style="color: #0000BB">$mensaje </span><span style="color: #007700">= </span><span style="color: #DD0000">'mundo'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$ejemplo</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">// Los cierres también aceptan argumentos normales<br /></span><span style="color: #0000BB">$ejemplo </span><span style="color: #007700">= function (</span><span style="color: #0000BB">$arg</span><span style="color: #007700">) use (</span><span style="color: #0000BB">$mensaje</span><span style="color: #007700">) {<br />    </span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$arg </span><span style="color: #007700">. </span><span style="color: #DD0000">' ' </span><span style="color: #007700">. </span><span style="color: #0000BB">$mensaje</span><span style="color: #007700">);<br />};<br /></span><span style="color: #0000BB">$ejemplo</span><span style="color: #007700">(</span><span style="color: #DD0000">"hola"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
   </div>

   <div class="example-contents"><p>El resultado del ejemplo
sería algo similar a:</p></div>
   <div class="example-contents screen">
<div class="cdata"><pre>
Notice: Undefined variable: message in /example.php on line 6
NULL
string(4) &quot;hola&quot;
string(4) &quot;hola&quot;
string(4) &quot;hola&quot;
string(5) &quot;mundo&quot;
string(10) &quot;hola mundo&quot;
</pre></div>
   </div>
  </div>

  <p class="simpara">
   Heredar variables del ámbito padre <em>no</em>
   es lo mismo que usar variables globales.
   Las variables globales existen en el ámbito global, lo que implica que no
   importa qué función se esté ejecutando. El ámbito padre de un cierre es la
   función en la que dicho cierre fue declarado (no necesariamente la función
   desde la que se llamó). Vea el siguiente ejemplo:
  </p>

  <div class="example" id="example-197">
   <p><strong>Ejemplo #4 Cierres y ámbito</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">// Un carro de compras básico que contiene una lista de productos añadidos<br />// y la cantidad de cada producto. Incluye un método que<br />// calcula el precio total de los artículos del carro usando un<br />// cierre como llamada de retorno.<br /></span><span style="color: #007700">class </span><span style="color: #0000BB">Carro<br /></span><span style="color: #007700">{<br />    const </span><span style="color: #0000BB">PRECIO_MANTEQUILLA </span><span style="color: #007700">= </span><span style="color: #0000BB">1.00</span><span style="color: #007700">;<br />    const </span><span style="color: #0000BB">PRECIO_LECHE       </span><span style="color: #007700">= </span><span style="color: #0000BB">3.00</span><span style="color: #007700">;<br />    const </span><span style="color: #0000BB">PRECIO_HUEVOS      </span><span style="color: #007700">= </span><span style="color: #0000BB">6.95</span><span style="color: #007700">;<br /><br />    protected </span><span style="color: #0000BB">$productos </span><span style="color: #007700">= array();<br /><br />    public function </span><span style="color: #0000BB">añadir</span><span style="color: #007700">(</span><span style="color: #0000BB">$producto</span><span style="color: #007700">, </span><span style="color: #0000BB">$cantidad</span><span style="color: #007700">)<br />    {<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">productos</span><span style="color: #007700">[</span><span style="color: #0000BB">$producto</span><span style="color: #007700">] = </span><span style="color: #0000BB">$cantidad</span><span style="color: #007700">;<br />    }<br /><br />    public function </span><span style="color: #0000BB">obtenerCantidad</span><span style="color: #007700">(</span><span style="color: #0000BB">$producto</span><span style="color: #007700">)<br />    {<br />        return isset(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">productos</span><span style="color: #007700">[</span><span style="color: #0000BB">$producto</span><span style="color: #007700">]) ? </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">productos</span><span style="color: #007700">[</span><span style="color: #0000BB">$producto</span><span style="color: #007700">] :<br />               </span><span style="color: #0000BB">FALSE</span><span style="color: #007700">;<br />    }<br /><br />    public function </span><span style="color: #0000BB">obtenerTotal</span><span style="color: #007700">(</span><span style="color: #0000BB">$impuesto</span><span style="color: #007700">)<br />    {<br />        </span><span style="color: #0000BB">$total </span><span style="color: #007700">= </span><span style="color: #0000BB">0.00</span><span style="color: #007700">;<br /><br />        </span><span style="color: #0000BB">$llamadaDeRetorno </span><span style="color: #007700">=<br />            function (</span><span style="color: #0000BB">$cantidad</span><span style="color: #007700">, </span><span style="color: #0000BB">$producto</span><span style="color: #007700">) use (</span><span style="color: #0000BB">$impuesto</span><span style="color: #007700">, &amp;</span><span style="color: #0000BB">$total</span><span style="color: #007700">)<br />            {<br />                </span><span style="color: #0000BB">$precioUnidad </span><span style="color: #007700">= </span><span style="color: #0000BB">constant</span><span style="color: #007700">(</span><span style="color: #0000BB">__CLASS__ </span><span style="color: #007700">. </span><span style="color: #DD0000">"::PRECIO_" </span><span style="color: #007700">.<br />                    </span><span style="color: #0000BB">strtoupper</span><span style="color: #007700">(</span><span style="color: #0000BB">$producto</span><span style="color: #007700">));<br />                </span><span style="color: #0000BB">$total </span><span style="color: #007700">+= (</span><span style="color: #0000BB">$precioUnidad </span><span style="color: #007700">* </span><span style="color: #0000BB">$cantidad</span><span style="color: #007700">) * (</span><span style="color: #0000BB">$impuesto </span><span style="color: #007700">+ </span><span style="color: #0000BB">1.0</span><span style="color: #007700">);<br />            };<br /><br />        </span><span style="color: #0000BB">array_walk</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">productos</span><span style="color: #007700">, </span><span style="color: #0000BB">$llamadaDeRetorno</span><span style="color: #007700">);<br />        return </span><span style="color: #0000BB">round</span><span style="color: #007700">(</span><span style="color: #0000BB">$total</span><span style="color: #007700">, </span><span style="color: #0000BB">2</span><span style="color: #007700">);<br />    }<br />}<br /><br /></span><span style="color: #0000BB">$mi_carro </span><span style="color: #007700">= new </span><span style="color: #0000BB">Carro</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// Añadir algunos artículos al carro<br /></span><span style="color: #0000BB">$mi_carro</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">añadir</span><span style="color: #007700">(</span><span style="color: #DD0000">'mantequilla'</span><span style="color: #007700">, </span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$mi_carro</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">añadir</span><span style="color: #007700">(</span><span style="color: #DD0000">'leche'</span><span style="color: #007700">, </span><span style="color: #0000BB">3</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$mi_carro</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">añadir</span><span style="color: #007700">(</span><span style="color: #DD0000">'huevos'</span><span style="color: #007700">, </span><span style="color: #0000BB">6</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// Imprimir el total con un impuesto de venta del 5%.<br /></span><span style="color: #007700">print </span><span style="color: #0000BB">$mi_carro</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">obtenerTotal</span><span style="color: #007700">(</span><span style="color: #0000BB">0.05</span><span style="color: #007700">) . </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /></span><span style="color: #FF8000">// El resultado es 54.29<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
   </div>

  </div>

  <div class="example" id="example-198">
   <p><strong>Ejemplo #5 Vinculación automática de <code class="literal">$this</code></strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #007700">class </span><span style="color: #0000BB">Test<br /></span><span style="color: #007700">{<br />    public function </span><span style="color: #0000BB">testing</span><span style="color: #007700">()<br />    {<br />        return function() {<br />            </span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">);<br />        };<br />    }<br />}<br /><br /></span><span style="color: #0000BB">$object </span><span style="color: #007700">= new </span><span style="color: #0000BB">Test</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$function </span><span style="color: #007700">= </span><span style="color: #0000BB">$object</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">testing</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$function</span><span style="color: #007700">();<br /><br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
   </div>

   <div class="example-contents"><p>El resultado del ejemplo sería:</p></div>
   <div class="example-contents screen">
<div class="cdata"><pre>
object(Test)#1 (0) {
}
</pre></div>
   </div>
   <div class="example-contents"><p>Salida del ejemplo anterior en PHP 5.3:</p></div>
   <div class="example-contents screen">
<div class="cdata"><pre>
Notice: Undefined variable: this in script.php on line 8
NULL</pre></div>
   </div>
  </div>

  <p class="para">
   A partir de PHP 5.4.0, cuando se declara en el contexto de una clase, la clase actual está
   vinculada a ella automáticamente, haciendo que <code class="literal">$this</code> esté disponible
   dentro del ámbito de la función. Si no se desea esta vinculación automática
   de la clase actual, se deberían usar
   <a href="functions.anonymous.html#functions.anonymous-functions.static" class="link">funcions anónimas
    estáticas</a> en su lugar.
  </p>

  <div class="sect2" id="functions.anonymous-functions.static">
   <h3 class="title">Static anonymous functions</h3>
   <p class="para">
    A partir de PHP 5.4, las funciones anónimas pueden ser declaradas estáticamente. Esto
    evita tener la clase actual vinculada automáticamente a
    ellas. Los objetos tampoco podrían vincularse a ellas durante la ejecución.
   </p>
   <p class="para">
    <div class="example" id="example-199">
     <p><strong>Ejemplo #6 Intentar usar <code class="literal">$this</code> dentro de una función anónima estática</strong></p>
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #007700">class </span><span style="color: #0000BB">Foo<br /></span><span style="color: #007700">{<br />    function </span><span style="color: #0000BB">__construct</span><span style="color: #007700">()<br />    {<br />        </span><span style="color: #0000BB">$func </span><span style="color: #007700">= static function() {<br />            </span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">);<br />        };<br />        </span><span style="color: #0000BB">$func</span><span style="color: #007700">();<br />    }<br />};<br />new </span><span style="color: #0000BB">Foo</span><span style="color: #007700">();<br /><br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
     </div>

     <div class="example-contents"><p>El resultado del ejemplo sería:</p></div>
     <div class="example-contents screen">
<div class="cdata"><pre>
Notice: Undefined variable: this in %s on line %d
NULL
</pre></div>
     </div>
    </div>
   </p>

   <p class="para">
    <div class="example" id="example-200">
     <p><strong>Ejemplo #7 Intentar vincular un objeto a una función anónima estática</strong></p>
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /><br />$func </span><span style="color: #007700">= static function() {<br />    </span><span style="color: #FF8000">// cuerpo de la función<br /></span><span style="color: #007700">};<br /></span><span style="color: #0000BB">$func </span><span style="color: #007700">= </span><span style="color: #0000BB">$func</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">bindTo</span><span style="color: #007700">(new </span><span style="color: #0000BB">StdClass</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$func</span><span style="color: #007700">();<br /><br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
     </div>

     <div class="example-contents"><p>El resultado del ejemplo sería:</p></div>
     <div class="example-contents screen">
<div class="cdata"><pre>
Warning: Cannot bind an instance to a static closure in %s on line %d
</pre></div>
     </div>
    </div>
   </p>
  </div>

  <div class="sect2">
   <h3 class="title">Historial de cambios</h3>
   <p class="para">
    <table class="doctable informaltable">
     
      <thead>
       <tr>
        <th>Versión</th>
        <th>Descripción</th>
       </tr>

      </thead>

      <tbody class="tbody">
       <tr>
        <td>7.1.0</td>
        <td>
         Las funciones anónimas no pueden tener un cierre sobre <a href="language.variables.predefined.html" class="link">superglobals</a>,
         <var class="varname">$this</var>, o cualquier variable con el mismo nombre que un
         parámetro.
        </td>
       </tr>

       <tr>
        <td>5.4.0</td>
        <td>
         Las funciones anónimas pueden usar <var class="varname">$this</var>, así como ser
         declaradas státicamente.
        </td>
       </tr>

       <tr>
        <td>5.3.0</td>
        <td>
         Las funciones anónimas se encuentran disponibles.
        </td>
       </tr>

      </tbody>
     
    </table>

   </p>
  </div>

<div class="sect2">
    <h3 class="title">Notas</h3>
    <blockquote class="note"><p><strong class="note">Nota</strong>: 
     <span class="simpara">
      Es posible utilizar <span class="function"><a href="function.func-num-args.html" class="function">func_num_args()</a></span>,
      <span class="function"><a href="function.func-get-arg.html" class="function">func_get_arg()</a></span>, y <span class="function"><a href="function.func-get-args.html" class="function">func_get_args()</a></span>
      desde dentro de un cierre.
     </span>
    </p></blockquote>
   </div>

  </div></div></div></body></html>