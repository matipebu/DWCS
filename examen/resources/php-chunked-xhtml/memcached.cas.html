<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Comparar e intercambiar un &iacute;tem</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

 </head>
 <body class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="memcached.appendbykey.html">« Memcached::appendByKey</a></li>
      <li style="float: right;"><a href="memcached.casbykey.html">Memcached::casByKey »</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="class.memcached.html">Memcached</a></li>
    <li>Comparar e intercambiar un &iacute;tem</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="memcached.cas" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">Memcached::cas</h1>
  <p class="verinfo">(PECL memcached &gt;= 0.1.0)</p><p class="refpurpose"><span class="refname">Memcached::cas</span> &mdash; <span class="dc-title">Comparar e intercambiar un ítem</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-memcached.cas-description">
  <h3 class="title">Descripción</h3>
  <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="methodname"><strong>Memcached::cas</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type"><a href="language.types.float.html" class="type float">float</a></span> <code class="parameter">$cas_token</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type"><a href="language.types.string.html" class="type string">string</a></span> <code class="parameter">$key</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type"><a href="language.types.mixed.html" class="type mixed">mixed</a></span> <code class="parameter">$value</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type"><a href="language.types.integer.html" class="type int">int</a></span> <code class="parameter">$expiration</code><span class="initializer"> = ?</span></span><br>): <span class="type"><a href="language.types.boolean.html" class="type bool">bool</a></span></div>

  <p class="para rdfs-comment">
   <span class="function"><strong>Memcached::cas()</strong></span> realiza una operación &quot;comprobar y establecer&quot; (&#039;cas&#039; por sus siglas en inglés),
   de forma que el ítem será guardado solamente si ningún otro cliente lo actualizó
   desde la última vez que este cliente lo obtuvo. La comprobación se realiza mediante
   el parámetro <code class="parameter">cas_token</code>, el cual es un valor único de 64 bit
   asignado al ítem existente por memcache. Ver la documentación de los métodos
   <span class="methodname"><strong>Memcached::get*()</strong></span> para saber cómo obtener este
   token. Observar que el token está representado como un valor de tipo double debido a
   las limitaciones de espacio para valores integer de PHP.
  </p>
 </div>

 
 <div class="refsect1 parameters" id="refsect1-memcached.cas-parameters">
  <h3 class="title">Parámetros</h3>
  <p class="para">
   <dl>
    
     <dt><code class="parameter">cas_token</code></dt>
     <dd>
      <p class="para">
       El valor único asociado con el ítem existente. Generado por memcache.
      </p>
     </dd>
    
    
     <dt><code class="parameter">key</code></dt>
     <dd>
      <p class="para">
       La clave en la que se guardará el valor.
      </p>
     </dd>
    
    
     <dt><code class="parameter">value</code></dt>
     <dd>
      <p class="para">
       El valor a guardar.
      </p>
     </dd>
    
    
     <dt><code class="parameter">expiration</code></dt>
     <dd>
      <p class="para">
       Tiempo de expiración, que por defecto es 0. Ver <a href="memcached.expiration.html" class="link">Tiempos de expiración</a> para más información.
      </p>
     </dd>
    
   </dl>
  </p>
 </div>

 
 <div class="refsect1 returnvalues" id="refsect1-memcached.cas-returnvalues">
  <h3 class="title">Valores devueltos</h3>
  <p class="para">
   Devuelve <strong><code><a href="reserved.constants.html#constant.true">true</a></code></strong> en caso de éxito o <strong><code><a href="reserved.constants.html#constant.false">false</a></code></strong> en caso de error.
   <span class="methodname"><a href="memcached.getresultcode.html" class="methodname">Memcached::getResultCode()</a></span> devolverá
   <strong><code><a href="memcached.constants.html#memcached.constants.res-data-exists">Memcached::RES_DATA_EXISTS</a></code></strong> si el ítem que se trata
   de guardar ha sido modificado desde la última vez que se obtuvo.
  </p>
 </div>

 
 <div class="refsect1 examples" id="refsect1-memcached.cas-examples">
  <h3 class="title">Ejemplos</h3>
  <p class="para">
   <div class="example" id="example-4398">
    <p><strong>Ejemplo #1 Ejemplo de <span class="function"><strong>Memcached::cas()</strong></span></strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />$m </span><span style="color: #007700">= new </span><span style="color: #0000BB">Memcached</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$m</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addServer</span><span style="color: #007700">(</span><span style="color: #DD0000">'localhost'</span><span style="color: #007700">, </span><span style="color: #0000BB">11211</span><span style="color: #007700">);<br /><br />do {<br />    </span><span style="color: #FF8000">/* obtener la lista de direcciones IP y sus token */<br />    </span><span style="color: #0000BB">$ips </span><span style="color: #007700">= </span><span style="color: #0000BB">$m</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">get</span><span style="color: #007700">(</span><span style="color: #DD0000">'ip_block'</span><span style="color: #007700">, </span><span style="color: #0000BB">null</span><span style="color: #007700">, </span><span style="color: #0000BB">$cas</span><span style="color: #007700">);<br />    </span><span style="color: #FF8000">/* si la lista no existe aún, crear una y realizar<br />       un añadido atómico que fallará si alguien ya añadió un valor */<br />    </span><span style="color: #007700">if (</span><span style="color: #0000BB">$m</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getResultCode</span><span style="color: #007700">() == </span><span style="color: #0000BB">Memcached</span><span style="color: #007700">::</span><span style="color: #0000BB">RES_NOTFOUND</span><span style="color: #007700">) {<br />        </span><span style="color: #0000BB">$ips </span><span style="color: #007700">= array(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'REMOTE_ADDR'</span><span style="color: #007700">]);<br />        </span><span style="color: #0000BB">$m</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">add</span><span style="color: #007700">(</span><span style="color: #DD0000">'ip_block'</span><span style="color: #007700">, </span><span style="color: #0000BB">$ips</span><span style="color: #007700">);<br />    </span><span style="color: #FF8000">/* en caso contrario, añadir la IP a la lista y guardar vía comparar-e-intercambiar<br />       con el token, que fallará si alguien ya actualizó la lista */<br />    </span><span style="color: #007700">} else { <br />        </span><span style="color: #0000BB">$ips</span><span style="color: #007700">[] = </span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'REMOTE_ADDR'</span><span style="color: #007700">];<br />        </span><span style="color: #0000BB">$m</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">cas</span><span style="color: #007700">(</span><span style="color: #0000BB">$cas</span><span style="color: #007700">, </span><span style="color: #DD0000">'ip_block'</span><span style="color: #007700">, </span><span style="color: #0000BB">$ips</span><span style="color: #007700">);<br />    }   <br />} while (</span><span style="color: #0000BB">$m</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getResultCode</span><span style="color: #007700">() != </span><span style="color: #0000BB">Memcached</span><span style="color: #007700">::</span><span style="color: #0000BB">RES_SUCCESS</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
    </div>

   </div>
  </p>
 </div>

 
 <div class="refsect1 seealso" id="refsect1-memcached.cas-seealso">
  <h3 class="title">Ver también</h3>
  <p class="para">
   <ul class="simplelist">
    <li><span class="methodname"><a href="memcached.casbykey.html" class="methodname" rel="rdfs-seeAlso">Memcached::casByKey()</a> - Comparar e intercambiar un &iacute;tem en un servidor espec&iacute;fico</span></li>
   </ul>
  </p>
 </div>

 
</div></div></div></body></html>