<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>La clase SessionHandler</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

 </head>
 <body class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.session-write-close.html">« session_write_close</a></li>
      <li style="float: right;"><a href="sessionhandler.close.html">SessionHandler::close »</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="book.session.html">Sesiones</a></li>
    <li>La clase SessionHandler</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="class.sessionhandler" class="reference">
 
 <h1 class="title">La clase SessionHandler</h1>
 
 
 <div class="partintro"><p class="verinfo">(PHP 5 &gt;= 5.4.0, PHP 7, PHP 8)</p>
  
  
  <div class="section" id="sessionhandler.intro">
   <h2 class="title">Introducción</h2>
   <p class="para">
    <span class="classname"><strong class="classname">SessionHandler</strong></span> es una clase especial que puede usarse
    para exponer el gestor de almacenamiento de sesiones interno actual de PHP por herencia.
    Existen siete métodos que envuelven las sietes retrollamadas del gestor de almacenamiento
    de sesiones (<code class="parameter">open</code>, <code class="parameter">close</code>,
    <code class="parameter">read</code>, <code class="parameter">write</code>,
    <code class="parameter">destroy</code>, <code class="parameter">gc</code> y
    <code class="parameter">create_sid</code>). Por defecto, esta clase envolverá
    cualquier gestor de almacenamiento que esté establecido como está definido por la
    directiva de configuración <a href="session.configuration.html#ini.session.save-handler" class="link">session.save_handler</a>,
    el cual normalmente es <code class="parameter">files</code> por
    omisión. Otros gestores de almacenamiento de sesión internos son proporcionados por
    extensiones de PHP tales como SQLite (como <code class="parameter">sqlite</code>), Memcache (como
    <code class="parameter">memcache</code>), y Memcached (como
    <code class="parameter">Memcached</code>).
   </p>
   <p class="para">
    Cuando se establece una simple instancia de <span class="classname"><strong class="classname">SessionHandler</strong></span> como el gestor de almacenamiento usando
    <span class="function"><a href="function.session-set-save-handler.html" class="function">session_set_save_handler()</a></span>, envolverá los gestores de almacenamiento actuales.
    Una clase que extienda de <span class="classname"><strong class="classname">SessionHandler</strong></span> permite sobrescribir
    los métodos o interceptarlos o filtrarlos llamando a los métodos de la clase madre, los cuales en última instancia envolverán
    los gestores de sesiones de PHP internos.
   </p>
   <p class="para">
    Esto permite, por ejemplo, interceptar los métodos <code class="parameter">read</code> y <code class="parameter">write</code>
    para encriptar/desencriptar la información de sesión y luego pasar el resultado hacia y desde la clase madre.
    De forma alternativa se podría elegir sobrescribir por completo un método como la llamada de retorno del recolector de basura
    <code class="parameter">gc</code>.
   </p>
   <p class="para">
    Ya que <span class="classname"><strong class="classname">SessionHandler</strong></span> envuelve los métodos del gestor de almacenamiento interno
    actual, el ejemplo de arriba de encriptación puede aplicarse a cualquier gestor de almacenamiento interno sin
    tener que conocer los entresijos de los gestores.
   </p>
   <p class="para">
    Para usar esta clase, primero establezca el gestor de almacenamiento que desee exponer usando
    <a href="session.configuration.html#ini.session.save-handler" class="link">session.save_handler</a> y luego pasar una instancia de
    <span class="classname"><strong class="classname">SessionHandler</strong></span> o una que la extienda a <span class="function"><a href="function.session-set-save-handler.html" class="function">session_set_save_handler()</a></span>.
   </p>
   <p class="para">
    Observe que los métodos de llamda de retorno de esta clase están diseñados para ser llamados internamente por
    PHP y no para ser llamados desde código de espacio de usuario. Los valores devueltos son igualmente procesados internamente
    por PHP. Para más información sobre el flujo de trabajo de sesiones consulte <span class="function"><a href="function.session-set-save-handler.html" class="function">session_set_save_handler()</a></span>.
   </p>
  </div>
  
  
  <div class="section" id="sessionhandler.synopsis">
   <h2 class="title">Sinopsis de la Clase</h2>
   
   
   <div class="classsynopsis">
    <span class="ooclass"><strong class="classname"></strong></span>
    
    
    <div class="classsynopsisinfo">
     <span class="ooclass">
      <span class="modifier">class</span> <strong class="classname">SessionHandler</strong>
     </span>
     
     <span class="oointerface"><span class="modifier">implements</span> 
       <a href="class.sessionhandlerinterface.html" class="interfacename">SessionHandlerInterface</a></span> {</div>
    
    
    <div class="classsynopsisinfo classsynopsisinfo_comment">/* Métodos */</div>
    <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="methodname"><a href="sessionhandler.close.html" class="methodname">close</a></span>(): <span class="type"><a href="language.types.boolean.html" class="type bool">bool</a></span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="sessionhandler.create-sid.html" class="methodname">create_sid</a></span>(): <span class="type"><a href="language.types.string.html" class="type string">string</a></span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="sessionhandler.destroy.html" class="methodname">destroy</a></span>(<span class="methodparam"><span class="type"><a href="language.types.string.html" class="type string">string</a></span> <code class="parameter">$session_id</code></span>): <span class="type"><a href="language.types.boolean.html" class="type bool">bool</a></span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="sessionhandler.gc.html" class="methodname">gc</a></span>(<span class="methodparam"><span class="type"><a href="language.types.integer.html" class="type int">int</a></span> <code class="parameter">$maxlifetime</code></span>): <span class="type"><a href="language.types.integer.html" class="type int">int</a></span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="sessionhandler.open.html" class="methodname">open</a></span>(<span class="methodparam"><span class="type"><a href="language.types.string.html" class="type string">string</a></span> <code class="parameter">$save_path</code></span>, <span class="methodparam"><span class="type"><a href="language.types.string.html" class="type string">string</a></span> <code class="parameter">$session_name</code></span>): <span class="type"><a href="language.types.boolean.html" class="type bool">bool</a></span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="sessionhandler.read.html" class="methodname">read</a></span>(<span class="methodparam"><span class="type"><a href="language.types.string.html" class="type string">string</a></span> <code class="parameter">$session_id</code></span>): <span class="type"><a href="language.types.string.html" class="type string">string</a></span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="sessionhandler.write.html" class="methodname">write</a></span>(<span class="methodparam"><span class="type"><a href="language.types.string.html" class="type string">string</a></span> <code class="parameter">$session_id</code></span>, <span class="methodparam"><span class="type"><a href="language.types.string.html" class="type string">string</a></span> <code class="parameter">$session_data</code></span>): <span class="type"><a href="language.types.boolean.html" class="type bool">bool</a></span></div>

   }</div>
   
   
  </div>
  
  <div class="section" id="session.notes">
   <div class="warning"><strong class="warning">Advertencia</strong>
    <p class="para">
     Esta clase está diseñada para exponer el gestor de almacenamiento de sesiones interno de PHP, si quiere
     escribir sus propios gestores de almacenamiento, implemente la interfaz <span class="classname"><a href="class.sessionhandlerinterface.html" class="classname">SessionHandlerInterface</a></span>
     en lugar de extender desde <span class="classname"><strong class="classname">SessionHandler</strong></span>.
    </p>
   </div>
  </div>
  
  <div class="section" id="sessionhandler.changelog">
   <h2 class="title">Historial de cambios</h2>
   <p class="para">
    <table class="doctable informaltable">
     
      <thead>
       <tr>
        <th>Versión</th>
        <th>Descripción</th>
       </tr>

      </thead>

      <tbody class="tbody">
       <tr>
        <td>5.5.1</td>
        <td>
         Se añadió <span class="function"><a href="sessionhandler.create-sid.html" class="function">SessionHandler::create_sid()</a></span>.
        </td>
       </tr>

      </tbody>
     
    </table>

   </p>
  </div>
  
  <div class="section" id="sessionhandler.examples">
   <div class="example" id="example-4733">
    <p><strong>Ejemplo #1 
     Usar <span class="classname"><strong class="classname">SessionHandler</strong></span> para añadir encriptación a los gestores de almacenamiento internos de PHP.
    </strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /><br /> </span><span style="color: #FF8000">/**<br />  * decrypt AES 256<br />  *<br />  * @param data $edata<br />  * @param string $password<br />  * @return decrypted data<br />  */<br /></span><span style="color: #007700">function </span><span style="color: #0000BB">decrypt</span><span style="color: #007700">(</span><span style="color: #0000BB">$edata</span><span style="color: #007700">, </span><span style="color: #0000BB">$password</span><span style="color: #007700">) {<br />    </span><span style="color: #0000BB">$data </span><span style="color: #007700">= </span><span style="color: #0000BB">base64_decode</span><span style="color: #007700">(</span><span style="color: #0000BB">$edata</span><span style="color: #007700">);<br />    </span><span style="color: #0000BB">$salt </span><span style="color: #007700">= </span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">, </span><span style="color: #0000BB">0</span><span style="color: #007700">, </span><span style="color: #0000BB">16</span><span style="color: #007700">);<br />    </span><span style="color: #0000BB">$ct </span><span style="color: #007700">= </span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">, </span><span style="color: #0000BB">16</span><span style="color: #007700">);<br /><br />    </span><span style="color: #0000BB">$rounds </span><span style="color: #007700">= </span><span style="color: #0000BB">3</span><span style="color: #007700">; </span><span style="color: #FF8000">// depends on key length<br />    </span><span style="color: #0000BB">$data00 </span><span style="color: #007700">= </span><span style="color: #0000BB">$password</span><span style="color: #007700">.</span><span style="color: #0000BB">$salt</span><span style="color: #007700">;<br />    </span><span style="color: #0000BB">$hash </span><span style="color: #007700">= array();<br />    </span><span style="color: #0000BB">$hash</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">] = </span><span style="color: #0000BB">hash</span><span style="color: #007700">(</span><span style="color: #DD0000">'sha256'</span><span style="color: #007700">, </span><span style="color: #0000BB">$data00</span><span style="color: #007700">, </span><span style="color: #0000BB">true</span><span style="color: #007700">);<br />    </span><span style="color: #0000BB">$result </span><span style="color: #007700">= </span><span style="color: #0000BB">$hash</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">];<br />    for (</span><span style="color: #0000BB">$i </span><span style="color: #007700">= </span><span style="color: #0000BB">1</span><span style="color: #007700">; </span><span style="color: #0000BB">$i </span><span style="color: #007700">&lt; </span><span style="color: #0000BB">$rounds</span><span style="color: #007700">; </span><span style="color: #0000BB">$i</span><span style="color: #007700">++) {<br />        </span><span style="color: #0000BB">$hash</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">] = </span><span style="color: #0000BB">hash</span><span style="color: #007700">(</span><span style="color: #DD0000">'sha256'</span><span style="color: #007700">, </span><span style="color: #0000BB">$hash</span><span style="color: #007700">[</span><span style="color: #0000BB">$i </span><span style="color: #007700">- </span><span style="color: #0000BB">1</span><span style="color: #007700">].</span><span style="color: #0000BB">$data00</span><span style="color: #007700">, </span><span style="color: #0000BB">true</span><span style="color: #007700">);<br />        </span><span style="color: #0000BB">$result </span><span style="color: #007700">.= </span><span style="color: #0000BB">$hash</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">];<br />    }<br />    </span><span style="color: #0000BB">$key </span><span style="color: #007700">= </span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$result</span><span style="color: #007700">, </span><span style="color: #0000BB">0</span><span style="color: #007700">, </span><span style="color: #0000BB">32</span><span style="color: #007700">);<br />    </span><span style="color: #0000BB">$iv  </span><span style="color: #007700">= </span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$result</span><span style="color: #007700">, </span><span style="color: #0000BB">32</span><span style="color: #007700">,</span><span style="color: #0000BB">16</span><span style="color: #007700">);<br /><br />    return </span><span style="color: #0000BB">openssl_decrypt</span><span style="color: #007700">(</span><span style="color: #0000BB">$ct</span><span style="color: #007700">, </span><span style="color: #DD0000">'AES-256-CBC'</span><span style="color: #007700">, </span><span style="color: #0000BB">$key</span><span style="color: #007700">, </span><span style="color: #0000BB">true</span><span style="color: #007700">, </span><span style="color: #0000BB">$iv</span><span style="color: #007700">);<br />  }<br /><br /></span><span style="color: #FF8000">/**<br /> * crypt AES 256<br /> *<br /> * @param data $data<br /> * @param string $password<br /> * @return base64 encrypted data<br /> */<br /></span><span style="color: #007700">function </span><span style="color: #0000BB">encrypt</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">, </span><span style="color: #0000BB">$password</span><span style="color: #007700">) {<br />    </span><span style="color: #FF8000">// Set a random salt<br />    </span><span style="color: #0000BB">$salt </span><span style="color: #007700">= </span><span style="color: #0000BB">openssl_random_pseudo_bytes</span><span style="color: #007700">(</span><span style="color: #0000BB">16</span><span style="color: #007700">);<br /><br />    </span><span style="color: #0000BB">$salted </span><span style="color: #007700">= </span><span style="color: #DD0000">''</span><span style="color: #007700">;<br />    </span><span style="color: #0000BB">$dx </span><span style="color: #007700">= </span><span style="color: #DD0000">''</span><span style="color: #007700">;<br />    </span><span style="color: #FF8000">// Salt the key(32) and iv(16) = 48<br />    </span><span style="color: #007700">while (</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$salted</span><span style="color: #007700">) &lt; </span><span style="color: #0000BB">48</span><span style="color: #007700">) {<br />      </span><span style="color: #0000BB">$dx </span><span style="color: #007700">= </span><span style="color: #0000BB">hash</span><span style="color: #007700">(</span><span style="color: #DD0000">'sha256'</span><span style="color: #007700">, </span><span style="color: #0000BB">$dx</span><span style="color: #007700">.</span><span style="color: #0000BB">$password</span><span style="color: #007700">.</span><span style="color: #0000BB">$salt</span><span style="color: #007700">, </span><span style="color: #0000BB">true</span><span style="color: #007700">);<br />      </span><span style="color: #0000BB">$salted </span><span style="color: #007700">.= </span><span style="color: #0000BB">$dx</span><span style="color: #007700">;<br />    }<br /><br />    </span><span style="color: #0000BB">$key </span><span style="color: #007700">= </span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$salted</span><span style="color: #007700">, </span><span style="color: #0000BB">0</span><span style="color: #007700">, </span><span style="color: #0000BB">32</span><span style="color: #007700">);<br />    </span><span style="color: #0000BB">$iv  </span><span style="color: #007700">= </span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$salted</span><span style="color: #007700">, </span><span style="color: #0000BB">32</span><span style="color: #007700">,</span><span style="color: #0000BB">16</span><span style="color: #007700">);<br /><br />    </span><span style="color: #0000BB">$encrypted_data </span><span style="color: #007700">= </span><span style="color: #0000BB">openssl_encrypt</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">, </span><span style="color: #DD0000">'AES-256-CBC'</span><span style="color: #007700">, </span><span style="color: #0000BB">$key</span><span style="color: #007700">, </span><span style="color: #0000BB">true</span><span style="color: #007700">, </span><span style="color: #0000BB">$iv</span><span style="color: #007700">);<br />    return </span><span style="color: #0000BB">base64_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$salt </span><span style="color: #007700">. </span><span style="color: #0000BB">$encrypted_data</span><span style="color: #007700">);<br />}<br /><br />class </span><span style="color: #0000BB">EncryptedSessionHandler </span><span style="color: #007700">extends </span><span style="color: #0000BB">SessionHandler<br /></span><span style="color: #007700">{<br />    private </span><span style="color: #0000BB">$key</span><span style="color: #007700">;<br /><br />    public function </span><span style="color: #0000BB">__construct</span><span style="color: #007700">(</span><span style="color: #0000BB">$key</span><span style="color: #007700">)<br />    {<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">key </span><span style="color: #007700">= </span><span style="color: #0000BB">$key</span><span style="color: #007700">;<br />    }<br /><br />    public function </span><span style="color: #0000BB">read</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">)<br />    {<br />        </span><span style="color: #0000BB">$data </span><span style="color: #007700">= </span><span style="color: #0000BB">parent</span><span style="color: #007700">::</span><span style="color: #0000BB">read</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">);<br /><br />        if (!</span><span style="color: #0000BB">$data</span><span style="color: #007700">) {<br />            return </span><span style="color: #DD0000">""</span><span style="color: #007700">;<br />        } else {<br />            return </span><span style="color: #0000BB">decrypt</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">, </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">key</span><span style="color: #007700">);<br />        }<br />    }<br /><br />    public function </span><span style="color: #0000BB">write</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">, </span><span style="color: #0000BB">$data</span><span style="color: #007700">)<br />    {<br />        </span><span style="color: #0000BB">$data </span><span style="color: #007700">= </span><span style="color: #0000BB">encrypt</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">, </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">key</span><span style="color: #007700">);<br /><br />        return </span><span style="color: #0000BB">parent</span><span style="color: #007700">::</span><span style="color: #0000BB">write</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">, </span><span style="color: #0000BB">$data</span><span style="color: #007700">);<br />    }<br />}<br /><br /></span><span style="color: #FF8000">// interceptaremos el manejador nativo 'files', pero funcionaría igualmente<br />// con otros manejadores nativos internos como 'sqlite', 'memcache' o 'memcached'<br />// que son proporcionados por extensiones de PHP.<br /></span><span style="color: #0000BB">ini_set</span><span style="color: #007700">(</span><span style="color: #DD0000">'session.save_handler'</span><span style="color: #007700">, </span><span style="color: #DD0000">'files'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$key </span><span style="color: #007700">= </span><span style="color: #DD0000">'secret_string'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$handler </span><span style="color: #007700">= new </span><span style="color: #0000BB">EncryptedSessionHandler</span><span style="color: #007700">(</span><span style="color: #0000BB">$key</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">session_set_save_handler</span><span style="color: #007700">(</span><span style="color: #0000BB">$handler</span><span style="color: #007700">, </span><span style="color: #0000BB">true</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">session_start</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">// proceder para establecer y recuperar valores por clave desde $_SESSION</span></span></code></div>
    </div>

   </div>
   <blockquote class="note"><p><strong class="note">Nota</strong>: 
    <p class="para">
     Ya que los métodos de esta clase están diseñados para se llamados internamente por PHP como parte del flujo de trabajo normal,
     las llamadas de las clases hijas a los métodos padre (es decir, los gestores nativos internos reales) devolverán <strong><code><a href="reserved.constants.html#constant.false">false</a></code></strong> a menos que
     la sesión haya sido iniciada realmente (automáticamente o explícitamente mediante <span class="function"><a href="function.session-start.html" class="function">session_start()</a></span>).
     Es importante considerar esto cuando se escriben unidades de pruebas donde los métodos de la clase podrían ser invocados manualmente.
    </p>
   </p></blockquote>
  </div>
  
 </div>
 
 































































 
<h2>Tabla de contenidos</h2><ul class="chunklist chunklist_reference"><li><a href="sessionhandler.close.html">SessionHandler::close</a> — Cerrar la sesi&oacute;n</li><li><a href="sessionhandler.create-sid.html">SessionHandler::create_sid</a> — Devuelve un nuevo ID de sesi&oacute;n</li><li><a href="sessionhandler.destroy.html">SessionHandler::destroy</a> — Destruir una sesi&oacute;n</li><li><a href="sessionhandler.gc.html">SessionHandler::gc</a> — Eliminar las sesiones antiguas</li><li><a href="sessionhandler.open.html">SessionHandler::open</a> — Inicializar una sesi&oacute;n</li><li><a href="sessionhandler.read.html">SessionHandler::read</a> — Leer informaci&oacute;n de la sesi&oacute;n</li><li><a href="sessionhandler.write.html">SessionHandler::write</a> — Escribir informaci&oacute;n de sesi&oacute;n</li></ul>
</div>
</div></div></body></html>