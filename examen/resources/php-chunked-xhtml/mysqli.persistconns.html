<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>La extensi&oacute;n mysqli y conexiones persistentes</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

 </head>
 <body class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="mysqli.resources.html">« Tipos de recursos</a></li>
      <li style="float: right;"><a href="mysqli.constants.html">Constantes predefinidas »</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="book.mysqli.html">MySQLi</a></li>
    <li>La extensi&oacute;n mysqli y conexiones persistentes</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="mysqli.persistconns" class="chapter">

 <h1 class="title">La extensión mysqli y conexiones persistentes</h1>


 <p class="para">
  EL soporte para conexiones persistentes fue introducido en PHP 5.3 para el
  extensión <code class="literal">mysqli</code>. El soporte ya estaba presente en
  PDO MYSQL y ext/mysql. La idea detrás de las conexiones persistentes es que
  una conexión entre un proceso cliente y una base de datos puede ser
  reutilizados por un proceso cliente, en lugar de ser creado y destruido
  varias veces. Esto reduce la sobrecarga de la creación de conexiones nuevas
  cada vez que es requerido, como las conexiones no utilizadas se almacenan en
  caché y están lista para ser reutilizadas.
 </p>
 
 <p class="para">
  A diferencia de la extensión mysql, mysqli no proporciona una función separada
  para la apertura de conexiones persistentes. Para abrir una conexión persistente
  debe de colocar <code class="literal">p:</code> al nombre del host cuando se conecta.
 </p>

 <p class="para">  
  El problema con las conexiones persistentes es que se pueden dejar en
  estados impredecibles por los clientes. Por ejemplo, un bloqueo de tabla puede
  ser activado antes de que un cliente termina de forma inesperada. Un nuevo
  proceso cliente reusando esta conexión persistente tendrá la conexión
  <q class="quote">tal cual</q>. Toda la limpieza tendría que ser realizada por el
  nuevo proceso cliente antes de que pudiera hacer buen uso de la conexión
  persistente, aumentando la carga sobre el programador.
 </p>

 <p class="para">
  La conexión persistente de la extensión <code class="literal">mysqli</code> no obstante
  incorpora manejo para limpieza de código. La limpieza llevada a cabo por
  <code class="literal">mysqli</code> incluye:
 </p>

 <ul class="itemizedlist">

  <li class="listitem">
   <p class="para">
    Rollback de transacciones activas
   </p>
  </li>

  <li class="listitem">
   <p class="para">
    Cierre y borrado de tablas temporales
   </p>
  </li>

  <li class="listitem">
   <p class="para">
    Desbloque de tablas
   </p>
  </li>

  <li class="listitem">
   <p class="para">
    Reestablece variables de sesión
   </p>
  </li>

  <li class="listitem">
   <p class="para">
    Cerrar consultas preparadas (siempre pasa con PHP)
   </p>
  </li>

  <li class="listitem">
   <p class="para">
    Cerrar controlador
   </p>
  </li>

  <li class="listitem">
   <p class="para">
    Quitar bloqueos adquiridos con <span class="function"><strong>GET_LOCK()</strong></span>
   </p>
  </li>

 </ul>

 <p class="para">
  Esto asegura que las conexiones persistentes se encuentran en un estado limpio
  para el retorno del conjunto de conexiones, antes de que el proceso cliente los use.
 </p>

 <p class="para">
 La extensión <code class="literal">mysqli</code> hace la limpieza automáticamente
 llamando a la función <code class="literal">mysql_change_user()</code> de C-API.
 </p>

 <p class="para">
  La característica de limpieza automática tiene sus ventajas y desventajas
  aunque. La ventaja es que el programador no necesita preocuparse por estar
  añadiendo el código de limpieza, ya que es llamdo automáticamente. Asi mismo,
  la desventaja es que el código podría volverse <em>potencialmente</em>
  un poco más lento, pues el código para realizar la limpieza necesita ejecutarse
  cada vez que una conexión es devuelta por el conjunto de conexiones.
 </p>

 <p class="para">
  Es posible desactivar el código de limpieza automática, mediante la
  compilación de PHP si se define
  <strong><code>MYSQLI_NO_CHANGE_USER_ON_PCONNECT</code></strong>.
 </p>

 <blockquote class="note"><p><strong class="note">Nota</strong>: 
  <p class="para">
   La extensión <code class="literal">mysqli</code> soporta conexiones persistentes
   utilizando ya sea el driver nativo de MySQL o la libreria cliente de MySQL.
  </p>
 </p></blockquote>

</div>
</div></div></body></html>