<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>P&aacute;gina de estado</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

 </head>
 <body class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="fpm.observability.html">« Observabilidad</a></li>
      <li style="float: right;"><a href="ref.fpm.html">FPM Funciones »</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="fpm.observability.html">Observabilidad</a></li>
    <li>P&aacute;gina de estado</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="fpm.status" class="sect1">
 <h2 class="title">Página de estado</h2>
 
 <p class="para">
  Esta página proporciona información sobre la configuración y el contenido de la página de estado de FPM.
  Véase también <span class="function"><a href="function.fpm-get-status.html" class="function">fpm_get_status()</a></span>.
 </p>

 <div class="sect2" id="fpm.status.configuration">
  <h3 class="title">Configuración</h3>
  
  <p class="para">
   La página de estado de FPM se puede habilitar estableciendo el parámetro de configuración
   <a href="install.fpm.configuration.html#pm.status-path" class="link">pm.status_path</a> en la
   configuración del pool de FPM.
  </p>

  <div class="caution"><strong class="caution">Precaución</strong>
   <p class="para">
    Por seguridad, la página de estado del FPM debería estar restringida a las solicitudes internas o a las IPs de clientes conocidos,
    ya que la página revela las URLs de las solicitudes y la información sobre los recursos disponibles.
   </p>
  </div>
  
  <p class="para">
   Dependiendo de la configuración del servidor web, podría ser necesario configurar el servidor web para
   permitir peticiones directamente a esta ruta, evitando cualquier script PHP. Un ejemplo de configuración
   para Apache con FPM  escuchando en UDS y <code class="literal">pm.status_path</code> establecido a
   <code class="literal">/fpm-status</code> se vería así:
  </p>

  <div class="informalexample">
   <div class="example-contents">
    <div class="apache-confcode"><pre class="apache-confcode">&lt;LocationMatch &quot;/fpm-status&quot;&gt;
 Order Allow,Deny
 Allow from 127.0.0.1
 ProxyPass &quot;unix:/var/run/php-fpm.sock|fcgi://localhost/fpm-status&quot;
&lt;/LocationMatch&gt;</pre>
</div>
   </div>

  </div>

  <p class="para">
   Después de recargar o reiniciar tanto el FPM como el servidor web, la página de estado será accesible desde
   el navegador (siempre que la petición provenga de una dirección IP permitida si se ha configurado
   la restricción de IP).
  </p>
 </div>

 <div class="sect2" id="fpm.status.parameters">
  <h3 class="title">Parámetros de consulta</h3>

  <p class="para">
   El formato de la salida de la página de estado puede modificarse especificando uno de los siguientes
   parámetros de consulta:
  </p>
  
  <ul class="simplelist">
   <li><code class="literal">html</code></li>
   <li><code class="literal">json</code></li>
   <li><code class="literal">openmetrics</code></li>
   <li><code class="literal">xml</code></li>
  </ul>

  <p class="para">
   También se puede devolver información adicional utilizando el parámetro de consulta completa <code class="literal">full</code>.
  </p>
  
  <p class="para">
   Ejemplo de URL de la página de estado:
  </p>
  
  <ul class="simplelist">
   <li>
    <code class="literal">https://localhost/fpm-status</code>
    - Salida breve en el formato de texto por defecto
   </li>
   <li>
    <code class="literal">https://localhost/fpm-status?full</code>
    - Salida completa en el formato de texto por defecto
   </li>
   <li>
    <code class="literal">https://localhost/fpm-status?json</code>
    - Breve salida en formato JSON
   </li>
   <li>
    <code class="literal">https://localhost/fpm-status?html&amp;full</code>
    - Salida completa en formato HTML
   </li>
  </ul>
 </div>
 
 <div class="sect2" id="fpm.status.contents">
  <h3 class="title">Información mostrada</h3>

  <p class="para">
   Los valores de fecha/hora utilizan el formato unix timestamp en la salida JSON y XML, de lo contrario utilizan
   el formato que da como resultado la siguiente fecha de ejemplo
   <code class="literal">&quot;03/Jun/2021:07:21:46 +0100&quot;</code>.
  </p>
  
  <table class="doctable table">
   <caption><strong>Información básica - Siempre se muestra en la página de estado</strong></caption>
   
    <thead>
     <tr>
      <th>Parámetro</th>
      <th>Descripción</th>
     </tr>

    </thead>

    <tbody class="tbody">
     <tr>
      <td>pool</td>
      <td>El nombre del conjunto de procesos FPM.</td>
     </tr>

     <tr>
      <td>proccess manager</td>
      <td>El tipo de gestor de procesos: estático, dinámico o a la carta.</td>
     </tr>

     <tr>
      <td>start time</td>
      <td>La fecha/hora en que se inició por última vez el conjunto de procesos.</td>
     </tr>

     <tr>
      <td>start since</td>
      <td>El tiempo en segundos desde que el conjunto de procesos se inició por última vez.</td>
     </tr>

     <tr>
      <td>accepted conn</td>
      <td>El número total de conexiones aceptadas.</td>
     </tr>

     <tr>
      <td>listen queue</td>
      <td>El número de solicitudes (backlog) en espera de un proceso libre.</td>
     </tr>

     <tr>
      <td>max listen queue</td>
      <td>El número máximo de solicitudes vistas en la cola de escucha en un momento dado.</td>
     </tr>

     <tr>
      <td>listen queue len</td>
      <td>El tamaño máximo permitido de la cola de escucha.</td>
     </tr>

     <tr>
      <td>idle processes</td>
      <td>El número de procesos que están actualmente inactivos (esperando peticiones).</td>
     </tr>

     <tr>
      <td>active processes</td>
      <td>El número de procesos que están procesando actualmente las solicitudes.</td>
     </tr>

     <tr>
      <td>total processes</td>
      <td>El número total actual de procesos.</td>
     </tr>

     <tr>
      <td>max active processes</td>
      <td>El número máximo de procesos activos simultáneamente.</td>
     </tr>

     <tr>
      <td>max children reached</td>
      <td>
       ¿Se ha alcanzado el número máximo de procesos? Si es así, el valor mostrado es
       <code class="literal">1</code> de lo contrario el valor es <code class="literal">0</code>.
      </td>
     </tr>

     <tr>
      <td>slow requests</td>
      <td>
       El número total de peticiones que han alcanzado el valor configurado en
       <code class="literal">request_slowlog_timeout</code>.
      </td>
     </tr>

    </tbody>
   
  </table>


  <table class="doctable table">
   <caption><strong>Información por proceso: - sólo se muestra en el modo <code class="literal">full</code> de salida completa</strong></caption>
   
    <thead>
     <tr>
      <th>Parámetro</th>
      <th>Descripción</th>
     </tr>

    </thead>

    <tbody class="tbody">
     <tr>
      <td>pid</td>
      <td>El PID del sistema del proceso.</td>
     </tr>

     <tr>
      <td>state</td>
      <td>El estado del proceso: inactivo, en ejecución, ...</td>
     </tr>

     <tr>
      <td>start time</td>
      <td>La fecha/hora en que se inició el proceso.</td>
     </tr>

     <tr>
      <td>start since</td>
      <td>El número de segundos desde que se inició el proceso.</td>
     </tr>

     <tr>
      <td>requests</td>
      <td>El número total de solicitudes servidas.</td>
     </tr>

     <tr>
      <td>request duration</td>
      <td>El tiempo total en segundos dedicado a servir peticiones.</td>
     </tr>

     <tr>
      <td>request method</td>
      <td>El método HTTP de la última solicitud servida.</td>
     </tr>

     <tr>
      <td>request uri</td>
      <td>
       El URI de la última solicitud servida (después del procesamiento del servidor web, puede ser siempre
       <code class="literal">/index.php</code> si se utiliza un patrón de redirección del controlador frontal (front controller).
      </td>
     </tr>

     <tr>
      <td>content length</td>
      <td>La longitud del cuerpo de la solicitud, en bytes, de la última solicitud.</td>
     </tr>

     <tr>
      <td>user</td>
      <td>El usuario HTTP (<code class="literal">PHP_AUTH_USER</code>) de la última petición.</td>
     </tr>

     <tr>
      <td>script</td>
      <td>
       La ruta completa del script ejecutado por la última petición. Será
       <code class="literal">&#039;-&#039;</code> si no se aplica (por ejemplo, solicitudes de páginas de estado).
      </td>
     </tr>

     <tr>
      <td>last request cpu</td>
      <td>
       El %cpu de la última petición.Será 0 si el proceso no está inactivo, ya que
       el cálculo se realiza cuando se completa el procesamiento de la solicitud
      </td>
     </tr>

     <tr>
      <td>last request memory</td>
      <td>
       La cantidad máxima de memoria consumida por la última petición. Será 0 si el proceso no está inactivo,
       ya que el cálculo se realiza cuando se completa el procesamiento de la solicitud.
      </td>
     </tr>

    </tbody>
   
  </table>


  <blockquote class="note"><p><strong class="note">Nota</strong>: 
   <p class="para">
    Todos los valores son específicos del pool y se restablecen cuando se reinicia FPM.
   </p>
  </p></blockquote>

  <blockquote class="note"><p><strong class="note">Nota</strong>: 
   <p class="para">
    La salida del formato OpenMetrics utiliza diferentes tipos de parámetros para adaptarse mejor al formato OpenMetrics.
    Los parámetros y las descripciones de sus valores se incluyen en la salida del formato OpenMetrics.
   </p>
  </p></blockquote>
 </div>

 <div class="sect2">
  <h3 class="title">Historial de cambios</h3>
  <table class="doctable informaltable">
   
    <thead>
     <tr>
      <th>Versión</th>
      <th>Descripción</th>
     </tr>

    </thead>

    <tbody class="tbody">
     <tr>
      <td>8.1.0</td>
      <td>Se ha añadido el formato openmetrics.</td>
     </tr>

    </tbody>
   
  </table>

 </div>
</div></div></div></body></html>