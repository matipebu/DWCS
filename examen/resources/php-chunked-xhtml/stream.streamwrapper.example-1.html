<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Ejemplo de clase registrada como envoltura de flujo</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

 </head>
 <body class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="stream.examples.html">« Ejemplos</a></li>
      <li style="float: right;"><a href="class.php-user-filter.html">php_user_filter »</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="stream.examples.html">Ejemplos</a></li>
    <li>Ejemplo de clase registrada como envoltura de flujo</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="stream.streamwrapper.example-1" class="section">
  <h2 class="title">Ejemplo de clase registrada como envoltura de flujo</h2>
  <p class="para">
   El ejemplo de abajo implementa un gestor de protocolo var:// que permite
   el acceso a la lectura/escritura de una variable global nominada usando un flujo de sistema de
   archivos estándar tal como <span class="function"><a href="function.fread.html" class="function">fread()</a></span>. El protocolo var://
   implementado abajo, dada la URL &quot;var://foo&quot;, leerá/escribirá información
   hacia/desde $GLOBALS[&quot;foo&quot;].
  </p>
  <p class="para">
   <div class="example" id="example-3768">
    <p><strong>Ejemplo #1 Un Flujo para leer/escribir variables globales</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #007700">class </span><span style="color: #0000BB">FlujoVariable </span><span style="color: #007700">{<br />    var </span><span style="color: #0000BB">$posición</span><span style="color: #007700">;<br />    var </span><span style="color: #0000BB">$nombre</span><span style="color: #007700">;<br /><br />    function </span><span style="color: #0000BB">stream_open</span><span style="color: #007700">(</span><span style="color: #0000BB">$ruta</span><span style="color: #007700">, </span><span style="color: #0000BB">$modo</span><span style="color: #007700">, </span><span style="color: #0000BB">$opciones</span><span style="color: #007700">, &amp;</span><span style="color: #0000BB">$ruta_abierta</span><span style="color: #007700">)<br />    {<br />        </span><span style="color: #0000BB">$url </span><span style="color: #007700">= </span><span style="color: #0000BB">parse_url</span><span style="color: #007700">(</span><span style="color: #0000BB">$ruta</span><span style="color: #007700">);<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">nombre </span><span style="color: #007700">= </span><span style="color: #0000BB">$url</span><span style="color: #007700">[</span><span style="color: #DD0000">"host"</span><span style="color: #007700">];<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">posición </span><span style="color: #007700">= </span><span style="color: #0000BB">0</span><span style="color: #007700">;<br /><br />        return </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />    }<br /><br />    function </span><span style="color: #0000BB">stream_read</span><span style="color: #007700">(</span><span style="color: #0000BB">$cuenta</span><span style="color: #007700">)<br />    {<br />        </span><span style="color: #0000BB">$ret </span><span style="color: #007700">= </span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$GLOBALS</span><span style="color: #007700">[</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">nombre</span><span style="color: #007700">], </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">posición</span><span style="color: #007700">, </span><span style="color: #0000BB">$cuenta</span><span style="color: #007700">);<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">posición </span><span style="color: #007700">+= </span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$ret</span><span style="color: #007700">);<br />        return </span><span style="color: #0000BB">$ret</span><span style="color: #007700">;<br />    }<br /><br />    function </span><span style="color: #0000BB">stream_write</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">)<br />    {<br />        </span><span style="color: #0000BB">$izquierda </span><span style="color: #007700">= </span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$GLOBALS</span><span style="color: #007700">[</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">nombre</span><span style="color: #007700">], </span><span style="color: #0000BB">0</span><span style="color: #007700">, </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">posición</span><span style="color: #007700">);<br />        </span><span style="color: #0000BB">$derecha </span><span style="color: #007700">= </span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$GLOBALS</span><span style="color: #007700">[</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">nombre</span><span style="color: #007700">], </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">posición </span><span style="color: #007700">+ </span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">));<br />        </span><span style="color: #0000BB">$GLOBALS</span><span style="color: #007700">[</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">nombre</span><span style="color: #007700">] = </span><span style="color: #0000BB">$izquierda </span><span style="color: #007700">. </span><span style="color: #0000BB">$data </span><span style="color: #007700">. </span><span style="color: #0000BB">$derecha</span><span style="color: #007700">;<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">posición </span><span style="color: #007700">+= </span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">);<br />        return </span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">);<br />    }<br /><br />    function </span><span style="color: #0000BB">stream_tell</span><span style="color: #007700">()<br />    {<br />        return </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">posición</span><span style="color: #007700">;<br />    }<br /><br />    function </span><span style="color: #0000BB">stream_eof</span><span style="color: #007700">()<br />    {<br />        return </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">posición </span><span style="color: #007700">&gt;= </span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$GLOBALS</span><span style="color: #007700">[</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">nombre</span><span style="color: #007700">]);<br />    }<br /><br />    function </span><span style="color: #0000BB">stream_seek</span><span style="color: #007700">(</span><span style="color: #0000BB">$índice</span><span style="color: #007700">, </span><span style="color: #0000BB">$dónde</span><span style="color: #007700">)<br />    {<br />        switch (</span><span style="color: #0000BB">$dónde</span><span style="color: #007700">) {<br />            case </span><span style="color: #0000BB">SEEK_SET</span><span style="color: #007700">:<br />                if (</span><span style="color: #0000BB">$índice </span><span style="color: #007700">&lt; </span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$GLOBALS</span><span style="color: #007700">[</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">nombre</span><span style="color: #007700">]) &amp;&amp; </span><span style="color: #0000BB">$índice </span><span style="color: #007700">&gt;= </span><span style="color: #0000BB">0</span><span style="color: #007700">) {<br />                     </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">posición </span><span style="color: #007700">= </span><span style="color: #0000BB">$índice</span><span style="color: #007700">;<br />                     return </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />                } else {<br />                     return </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />                }<br />                break;<br /><br />            case </span><span style="color: #0000BB">SEEK_CUR</span><span style="color: #007700">:<br />                if (</span><span style="color: #0000BB">$índice </span><span style="color: #007700">&gt;= </span><span style="color: #0000BB">0</span><span style="color: #007700">) {<br />                     </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">posición </span><span style="color: #007700">+= </span><span style="color: #0000BB">$índice</span><span style="color: #007700">;<br />                     return </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />                } else {<br />                     return </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />                }<br />                break;<br /><br />            case </span><span style="color: #0000BB">SEEK_END</span><span style="color: #007700">:<br />                if (</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$GLOBALS</span><span style="color: #007700">[</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">nombre</span><span style="color: #007700">]) + </span><span style="color: #0000BB">$índice </span><span style="color: #007700">&gt;= </span><span style="color: #0000BB">0</span><span style="color: #007700">) {<br />                     </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">posición </span><span style="color: #007700">= </span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$GLOBALS</span><span style="color: #007700">[</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">nombre</span><span style="color: #007700">]) + </span><span style="color: #0000BB">$índice</span><span style="color: #007700">;<br />                     return </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />                } else {<br />                     return </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />                }<br />                break;<br /><br />            default:<br />                return </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />        }<br />    }<br /><br />    function </span><span style="color: #0000BB">stream_metadata</span><span style="color: #007700">(</span><span style="color: #0000BB">$ruta</span><span style="color: #007700">, </span><span style="color: #0000BB">$opción</span><span style="color: #007700">, </span><span style="color: #0000BB">$var</span><span style="color: #007700">)<br />    {<br />        if(</span><span style="color: #0000BB">$opción</span><span style="color: #007700">== </span><span style="color: #0000BB">STREAM_META_TOUCH</span><span style="color: #007700">) {<br />            </span><span style="color: #0000BB">$url </span><span style="color: #007700">= </span><span style="color: #0000BB">parse_url</span><span style="color: #007700">(</span><span style="color: #0000BB">$ruta</span><span style="color: #007700">);<br />            </span><span style="color: #0000BB">$varname </span><span style="color: #007700">= </span><span style="color: #0000BB">$url</span><span style="color: #007700">[</span><span style="color: #DD0000">"host"</span><span style="color: #007700">];<br />            if(!isset(</span><span style="color: #0000BB">$GLOBALS</span><span style="color: #007700">[</span><span style="color: #0000BB">$varname</span><span style="color: #007700">])) {<br />                </span><span style="color: #0000BB">$GLOBALS</span><span style="color: #007700">[</span><span style="color: #0000BB">$varname</span><span style="color: #007700">] = </span><span style="color: #DD0000">''</span><span style="color: #007700">;<br />            }<br />            return </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />        }<br />        return </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />    }<br />}<br /><br /></span><span style="color: #0000BB">stream_wrapper_register</span><span style="color: #007700">(</span><span style="color: #DD0000">"var"</span><span style="color: #007700">, </span><span style="color: #DD0000">"FlujoVariable"</span><span style="color: #007700">)<br />    or die(</span><span style="color: #DD0000">"Error al registrar el protocolo"</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$mivar </span><span style="color: #007700">= </span><span style="color: #DD0000">""</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$fp </span><span style="color: #007700">= </span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">"var://mivar"</span><span style="color: #007700">, </span><span style="color: #DD0000">"r+"</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">fwrite</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">, </span><span style="color: #DD0000">"línea1\n"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">fwrite</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">, </span><span style="color: #DD0000">"línea2\n"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">fwrite</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">, </span><span style="color: #DD0000">"línea3\n"</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">rewind</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">);<br />while (!</span><span style="color: #0000BB">feof</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">)) {<br />    echo </span><span style="color: #0000BB">fgets</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">);<br />}<br /></span><span style="color: #0000BB">fclose</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$mivar</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
    </div>

    <div class="example-contents"><p>El resultado del ejemplo sería:</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
línea1
línea2
línea3
string(24) &quot;línea1
línea2
línea3
&quot;
</pre></div>
    </div>
   </div>
  </p>
 </div></div></div></body></html>