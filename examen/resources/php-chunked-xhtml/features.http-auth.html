<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Autenticaci&oacute;n HTTP con PHP</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

 </head>
 <body class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="features.html">« Caracter&iacute;sticas</a></li>
      <li style="float: right;"><a href="features.cookies.html">Cookies »</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="features.html">Caracter&iacute;sticas</a></li>
    <li>Autenticaci&oacute;n HTTP con PHP</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="features.http-auth" class="chapter">
 <h1 class="title">Autenticación HTTP con PHP</h1>


 <p class="simpara">
  Con la
  función <span class="function"><a href="function.header.html" class="function">header()</a></span> se puede enviar un mensaje de <code class="literal">&quot;Autenticación requerida&quot;</code>
  al navegador del cliente para mostrar una ventana emergente donde introducir un
  usuario y una contraseña. Una vez introducidos estos datos,
  el URL que contiene el script de PHP será invocado de nuevo con las
  <a href="reserved.variables.html" class="link">variables predefinidas</a>
  <var class="varname">PHP_AUTH_USER</var>, <var class="varname">PHP_AUTH_PW</var>
  y <var class="varname">AUTH_TYPE</var> establecidas al nombre de usuario, contraseña y
  tipo de autenticación, respectivamente. Estas variables se encuentran en
  el array <var class="varname"><a href="reserved.variables.server.html" class="classname">$_SERVER</a></var>. Se admiten ambos métodos de autenticación,
  &#039;Basic&#039; y &#039;Digest&#039; (desde PHP 5.1.0). Véase la
  función <span class="function"><a href="function.header.html" class="function">header()</a></span> para más información.
 </p>

 <p class="para">
  Un fragmento de un script de ejemplo que forzaría la autenticación
  en una página es el siguiente:
 </p>
 <p class="para">
  <div class="example" id="example-452">
   <p><strong>Ejemplo #1 Ejemplo de autenticación HTTP &#039;Basic&#039;</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">if (!isset(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'PHP_AUTH_USER'</span><span style="color: #007700">])) {<br />    </span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'WWW-Authenticate: Basic realm="Mi dominio"'</span><span style="color: #007700">);<br />    </span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'HTTP/1.0 401 Unauthorized'</span><span style="color: #007700">);<br />    echo </span><span style="color: #DD0000">'Texto a enviar si el usuario pulsa el botón Cancelar'</span><span style="color: #007700">;<br />    exit;<br />} else {<br />    echo </span><span style="color: #DD0000">"&lt;p&gt;Hola </span><span style="color: #007700">{</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'PHP_AUTH_USER'</span><span style="color: #007700">]}</span><span style="color: #DD0000">.&lt;/p&gt;"</span><span style="color: #007700">;<br />    echo </span><span style="color: #DD0000">"&lt;p&gt;Introdujo </span><span style="color: #007700">{</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'PHP_AUTH_PW'</span><span style="color: #007700">]}</span><span style="color: #DD0000"> como su contraseña.&lt;/p&gt;"</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
   </div>

  </div>
 </p>

 <p class="para">
  <div class="example" id="example-453">
   <p><strong>Ejemplo #2 Ejemplo de autenticación HTTP &#039;Digest&#039;</strong></p>
   <div class="example-contents"><p>
    Este ejemplo muestra cómo implementar un sencillo script de
    autenticación HTTP &#039;Digest&#039;. Para más información lea el <a href="http://www.faqs.org/rfcs/rfc2617" class="link external">&raquo;&nbsp;RFC 2617</a>.
   </p></div>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />$dominio </span><span style="color: #007700">= </span><span style="color: #DD0000">'Area restringida'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// usuario =&gt; contraseña<br /></span><span style="color: #0000BB">$usuarios </span><span style="color: #007700">= array(</span><span style="color: #DD0000">'admin' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'micontraseña'</span><span style="color: #007700">, </span><span style="color: #DD0000">'invitado' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'invitado'</span><span style="color: #007700">);<br /><br /><br />if (empty(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'PHP_AUTH_DIGEST'</span><span style="color: #007700">])) {<br />    </span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'HTTP/1.1 401 Unauthorized'</span><span style="color: #007700">);<br />    </span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'WWW-Authenticate: Digest realm="'</span><span style="color: #007700">.</span><span style="color: #0000BB">$dominio</span><span style="color: #007700">.<br />           </span><span style="color: #DD0000">'",qop="auth",nonce="'</span><span style="color: #007700">.</span><span style="color: #0000BB">uniqid</span><span style="color: #007700">().</span><span style="color: #DD0000">'",opaque="'</span><span style="color: #007700">.</span><span style="color: #0000BB">md5</span><span style="color: #007700">(</span><span style="color: #0000BB">$dominio</span><span style="color: #007700">).</span><span style="color: #DD0000">'"'</span><span style="color: #007700">);<br /><br />    die(</span><span style="color: #DD0000">'Texto a enviar si el usuario pulsa el botón Cancelar'</span><span style="color: #007700">);<br />}<br /><br /><br /></span><span style="color: #FF8000">// Analizar la variable PHP_AUTH_DIGEST<br /></span><span style="color: #007700">if (!(</span><span style="color: #0000BB">$datos </span><span style="color: #007700">= </span><span style="color: #0000BB">analizar_http_digest</span><span style="color: #007700">(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'PHP_AUTH_DIGEST'</span><span style="color: #007700">])) ||<br />    !isset(</span><span style="color: #0000BB">$usuarios</span><span style="color: #007700">[</span><span style="color: #0000BB">$datos</span><span style="color: #007700">[</span><span style="color: #DD0000">'username'</span><span style="color: #007700">]]))<br />    die(</span><span style="color: #DD0000">'Credenciales incorrectas'</span><span style="color: #007700">);<br /><br /><br /></span><span style="color: #FF8000">// Generar una respuesta válida<br /></span><span style="color: #0000BB">$A1 </span><span style="color: #007700">= </span><span style="color: #0000BB">md5</span><span style="color: #007700">(</span><span style="color: #0000BB">$datos</span><span style="color: #007700">[</span><span style="color: #DD0000">'username'</span><span style="color: #007700">] . </span><span style="color: #DD0000">':' </span><span style="color: #007700">. </span><span style="color: #0000BB">$dominio </span><span style="color: #007700">. </span><span style="color: #DD0000">':' </span><span style="color: #007700">. </span><span style="color: #0000BB">$usuarios</span><span style="color: #007700">[</span><span style="color: #0000BB">$datos</span><span style="color: #007700">[</span><span style="color: #DD0000">'username'</span><span style="color: #007700">]]);<br /></span><span style="color: #0000BB">$A2 </span><span style="color: #007700">= </span><span style="color: #0000BB">md5</span><span style="color: #007700">(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'REQUEST_METHOD'</span><span style="color: #007700">].</span><span style="color: #DD0000">':'</span><span style="color: #007700">.</span><span style="color: #0000BB">$datos</span><span style="color: #007700">[</span><span style="color: #DD0000">'uri'</span><span style="color: #007700">]);<br /></span><span style="color: #0000BB">$respuesta_válida </span><span style="color: #007700">= </span><span style="color: #0000BB">md5</span><span style="color: #007700">(</span><span style="color: #0000BB">$A1</span><span style="color: #007700">.</span><span style="color: #DD0000">':'</span><span style="color: #007700">.</span><span style="color: #0000BB">$datos</span><span style="color: #007700">[</span><span style="color: #DD0000">'nonce'</span><span style="color: #007700">].</span><span style="color: #DD0000">':'</span><span style="color: #007700">.</span><span style="color: #0000BB">$datos</span><span style="color: #007700">[</span><span style="color: #DD0000">'nc'</span><span style="color: #007700">].</span><span style="color: #DD0000">':'</span><span style="color: #007700">.</span><span style="color: #0000BB">$datos</span><span style="color: #007700">[</span><span style="color: #DD0000">'cnonce'</span><span style="color: #007700">].</span><span style="color: #DD0000">':'</span><span style="color: #007700">.</span><span style="color: #0000BB">$datos</span><span style="color: #007700">[</span><span style="color: #DD0000">'qop'</span><span style="color: #007700">].</span><span style="color: #DD0000">':'</span><span style="color: #007700">.</span><span style="color: #0000BB">$A2</span><span style="color: #007700">);<br /><br />if (</span><span style="color: #0000BB">$datos</span><span style="color: #007700">[</span><span style="color: #DD0000">'response'</span><span style="color: #007700">] != </span><span style="color: #0000BB">$respuesta_válida</span><span style="color: #007700">)<br />    die(</span><span style="color: #DD0000">'Credenciales incorrectas'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// Todo bien, usuario y contraseña válidos<br /></span><span style="color: #007700">echo </span><span style="color: #DD0000">'Se ha identificado como: ' </span><span style="color: #007700">. </span><span style="color: #0000BB">$datos</span><span style="color: #007700">[</span><span style="color: #DD0000">'username'</span><span style="color: #007700">];<br /><br /><br /></span><span style="color: #FF8000">// Función para analizar la cabecera de autenticación HTTP<br /></span><span style="color: #007700">function </span><span style="color: #0000BB">analizar_http_digest</span><span style="color: #007700">(</span><span style="color: #0000BB">$txt</span><span style="color: #007700">)<br />{<br />    </span><span style="color: #FF8000">// Protección contra datos ausentes<br />    </span><span style="color: #0000BB">$partes_necesarias </span><span style="color: #007700">= array(</span><span style="color: #DD0000">'nonce'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">1</span><span style="color: #007700">, </span><span style="color: #DD0000">'nc'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">1</span><span style="color: #007700">, </span><span style="color: #DD0000">'cnonce'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">1</span><span style="color: #007700">, </span><span style="color: #DD0000">'qop'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">1</span><span style="color: #007700">, </span><span style="color: #DD0000">'username'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">1</span><span style="color: #007700">, </span><span style="color: #DD0000">'uri'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">1</span><span style="color: #007700">, </span><span style="color: #DD0000">'response'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br />    </span><span style="color: #0000BB">$datos </span><span style="color: #007700">= array();<br />    </span><span style="color: #0000BB">$claves </span><span style="color: #007700">= </span><span style="color: #0000BB">implode</span><span style="color: #007700">(</span><span style="color: #DD0000">'|'</span><span style="color: #007700">, </span><span style="color: #0000BB">array_keys</span><span style="color: #007700">(</span><span style="color: #0000BB">$partes_necesarias</span><span style="color: #007700">));<br /><br />    </span><span style="color: #0000BB">preg_match_all</span><span style="color: #007700">(</span><span style="color: #DD0000">'@(' </span><span style="color: #007700">. </span><span style="color: #0000BB">$claves </span><span style="color: #007700">. </span><span style="color: #DD0000">')=(?:([\'"])([^\2]+?)\2|([^\s,]+))@'</span><span style="color: #007700">, </span><span style="color: #0000BB">$txt</span><span style="color: #007700">, </span><span style="color: #0000BB">$coincidencias</span><span style="color: #007700">, </span><span style="color: #0000BB">PREG_SET_ORDER</span><span style="color: #007700">);<br /><br />    foreach (</span><span style="color: #0000BB">$coincidencias </span><span style="color: #007700">as </span><span style="color: #0000BB">$c</span><span style="color: #007700">) {<br />        </span><span style="color: #0000BB">$datos</span><span style="color: #007700">[</span><span style="color: #0000BB">$c</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">]] = </span><span style="color: #0000BB">$c</span><span style="color: #007700">[</span><span style="color: #0000BB">3</span><span style="color: #007700">] ? </span><span style="color: #0000BB">$c</span><span style="color: #007700">[</span><span style="color: #0000BB">3</span><span style="color: #007700">] : </span><span style="color: #0000BB">$c</span><span style="color: #007700">[</span><span style="color: #0000BB">4</span><span style="color: #007700">];<br />        unset(</span><span style="color: #0000BB">$partes_necesarias</span><span style="color: #007700">[</span><span style="color: #0000BB">$c</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">]]);<br />    }<br /><br />    return </span><span style="color: #0000BB">$partes_necesarias </span><span style="color: #007700">? </span><span style="color: #0000BB">false </span><span style="color: #007700">: </span><span style="color: #0000BB">$datos</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
   </div>

  </div>
 </p>

 <blockquote class="note"><p><strong class="note">Nota</strong>: 
  <strong>Sobre la compatibilidad</strong><br />
  <p class="para">
   Hay que tener cuidado al codificar las líneas de cabeceras HTTP. Para garantizar la mayor
   compatibilidad con todos los clientes, la palabra &#039;Basic&#039; debe escribirse con
   &#039;B&#039; mayúscula, la cadena del dominio debe estar entre comillas dobles (no simples),
   y debería haber exactamente un espacio precediendo al código <em>401</em> de la
   línea de la cabecera <em>HTTP/1.0 401</em>. Los parámetros de autenticación deben
   estar separados por comas, como se vió en el ejemplo de &#039;Digest&#039; anterior.
  </p>
 </p></blockquote>

 <p class="para">
  En lugar de imprimir simplemente <var class="varname">PHP_AUTH_USER</var>
  y <var class="varname">PHP_AUTH_PW</var> como se hizo en el ejemplo anterior,
  podría ser conveniente validar el usuario y la contraseña,
  tal vez enviando una consulta a una base de datos o buscando el
  usuario en un fichero dbm.
 </p>

 <p class="para">
  Cuidado con los navegadores Internet Explorer defectuosos. Parecen
  ser muy quisquillosos con el orden de las cabeceras. Por ahora,
  parece ser que el truco está en enviar la cabecera
  <em>WWW-Authenticate</em> antes que la cabecera
  <code class="literal">HTTP/1.0 401</code>.
 </p>

 <p class="simpara">
  Para prevenir que alguien escriba un script que
  revele la contraseña de una página que se autenticó con un
  mecanismo externo tradicional, las variables PHP_AUTH no se
  establecerán si la autenticación externa está habilitada para esa
  página en particular. Independientemente,
  se puede emplear <var class="varname">REMOTE_USER</var>
  para identificar al usuario autenticado externamente. De este modo, se podrá usar
  <var class="varname"><a href="reserved.variables.server.html" class="classname">$_SERVER['REMOTE_USER']</a></var>.
 </p>

 <blockquote class="note"><p><strong class="note">Nota</strong>: 
  <strong>Sobre la configuración</strong><br />
  <p class="para">
   PHP utiliza la presencia de una directiva <code class="literal">AuthType</code> para
   determinar si una autenticación externa está en uso.
  </p>
 </p></blockquote>

 <p class="simpara">
  Observe, sin embargo, que lo anterior no impide que alguien que
  controle un URL no autenticado pueda robar contraseñas
  de URL autenticados en el mismo servidor.
 </p>
 <p class="simpara">
  Tanto Netscape Navigator como Internet Explorer borran la caché de autenticación
  de la ventana del navegador local para el dominio al recibr una respuesta
  401 del servidor. Esto, en efecto, puede hacer que se cierre la sesión de un usuario,
  obligándolo a reintroducir su nombre de usuario y contraseña. Algunos utilizan esto para
  inicios de sesión «expiradas» o proveer un botón de «Cerrar sesión».
 </p>
 <p class="para">
  <div class="example" id="example-454">
   <p><strong>Ejemplo #3 Ejemplo de autenticación HTTP forzando un nuevo usuario/contraseña</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">function </span><span style="color: #0000BB">autenticar</span><span style="color: #007700">() {<br />    </span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'WWW-Authenticate: Basic realm="Sistema de autenticación de prueba"'</span><span style="color: #007700">);<br />    </span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'HTTP/1.0 401 Unauthorized'</span><span style="color: #007700">);<br />    echo </span><span style="color: #DD0000">"Debe introducir un ID y contraseña de identificación válidos para acceder a este recurso\n"</span><span style="color: #007700">;<br />    exit;<br />}<br /><br />if (!isset(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'PHP_AUTH_USER'</span><span style="color: #007700">]) ||<br />    (</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'VistoAntes'</span><span style="color: #007700">] == </span><span style="color: #0000BB">1 </span><span style="color: #007700">&amp;&amp; </span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'UsuarioAntiguo'</span><span style="color: #007700">] == </span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'PHP_AUTH_USER'</span><span style="color: #007700">])) {<br />    </span><span style="color: #0000BB">autenticar</span><span style="color: #007700">();<br />} else {<br />    echo </span><span style="color: #DD0000">"&lt;p&gt;Bienvenido: " </span><span style="color: #007700">. </span><span style="color: #0000BB">htmlspecialchars</span><span style="color: #007700">(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'PHP_AUTH_USER'</span><span style="color: #007700">]) . </span><span style="color: #DD0000">"&lt;br /&gt;"</span><span style="color: #007700">;<br />    echo </span><span style="color: #DD0000">"Antiguo: " </span><span style="color: #007700">. </span><span style="color: #0000BB">htmlspecialchars</span><span style="color: #007700">(</span><span style="color: #0000BB">$_REQUEST</span><span style="color: #007700">[</span><span style="color: #DD0000">'UsuarioAntiguo'</span><span style="color: #007700">]);<br />    echo </span><span style="color: #DD0000">"&lt;form action='' method='post'&gt;\n"</span><span style="color: #007700">;<br />    echo </span><span style="color: #DD0000">"&lt;input type='hidden' name='VistoAntes' value='1' /&gt;\n"</span><span style="color: #007700">;<br />    echo </span><span style="color: #DD0000">"&lt;input type='hidden' name='UsuarioAntiguo' value=\"" </span><span style="color: #007700">. </span><span style="color: #0000BB">htmlspecialchars</span><span style="color: #007700">(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'PHP_AUTH_USER'</span><span style="color: #007700">]) . </span><span style="color: #DD0000">"\" /&gt;\n"</span><span style="color: #007700">;<br />    echo </span><span style="color: #DD0000">"&lt;input type='submit' value='Reautenticar' /&gt;\n"</span><span style="color: #007700">;<br />    echo </span><span style="color: #DD0000">"&lt;/form&gt;&lt;/p&gt;\n"</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
   </div>

  </div>
 </p>
 <p class="simpara">
  El estándar de autenticación <code class="literal">HTTP Basic</code> no requiere
  este funcionamiento, por lo que no se debería depender de ello. Las pruebas con
  <code class="literal">Lynx</code> han mostrado que <code class="literal">Lynx</code> no limpia
  las credenciales de autenticación con una respuesta 401 del servidor, por lo que al presionar «atrás»
  y luego «adelante» abrirá el recurso nuevamente mientras los requisitos de credenciales
  no hayan cambiado. Sin embargo, el usuario puede pulsar la
  tecla <code class="literal">&#039;_&#039;</code> para limpiar su información de autenticación.
 </p>
 <p class="simpara">
  Para que la Autenticación HTTP funcione en un servidor IIS con la versión CGI
  de PHP, se debe editar la configuracion de &quot;<code class="literal">Seguridad de directorios</code>&quot; de IIS:
  hacer clic en &quot;<code class="literal">Editar</code>&quot; y solo marcar
  &quot;<code class="literal">Acceso anónimo</code>&quot;; todos los demas campos
  deberían estar sin marcar.
 </p>
 <blockquote class="note"><p><strong class="note">Nota</strong>: 
  <strong>Sobre IIS:</strong><br />
  <span class="simpara">
   Para que funcione la Autenticación HTTP con IIS, la directiva de PHP
   <a href="ini.core.html#ini.cgi.rfc2616-headers" class="link">cgi.rfc2616_headers</a> debe
   establecerse a <code class="literal">0</code> (el valor predeterminado).
  </span>
 </p></blockquote>

</div>
</div></div></body></html>